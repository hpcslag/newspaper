<!DOCTYPE html>
<html>
<head>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="google" value="notranslate">
  <!-- Site Properties -->
  <title>Explore - <%= webTitle %></title>
  <!-- Include Font Awesome. -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

  <link rel="stylesheet" type="text/css" href="stylesheets/semantic.min.css">
  <link rel="stylesheet" type="text/css" href="/components/reset.css">
  <link rel="stylesheet" type="text/css" href="/components/site.css">

  <link rel="stylesheet" type="text/css" href="/components/container.css">
  <link rel="stylesheet" type="text/css" href="/components/grid.css">
  <link rel="stylesheet" type="text/css" href="/components/header.css">
  <link rel="stylesheet" type="text/css" href="/components/image.css">
  <link rel="stylesheet" type="text/css" href="/components/menu.css">

  <link rel="stylesheet" type="text/css" href="/components/divider.css">
  <link rel="stylesheet" type="text/css" href="/components/dropdown.css">
  <link rel="stylesheet" type="text/css" href="/components/segment.css">
  <link rel="stylesheet" type="text/css" href="/components/button.css">
  <link rel="stylesheet" type="text/css" href="/components/list.css">
  <link rel="stylesheet" type="text/css" href="/components/icon.css">
  <link rel="stylesheet" type="text/css" href="/components/sidebar.css">
  <link rel="stylesheet" type="text/css" href="/components/transition.css">

  <style type="text/css">


    body.pushable > .pusher{
        background: #eeeeee !important;  
    }

    .hidden.menu {
      display: none;
    }

    .masthead.segment {
      min-height: 700px;
      padding: 1em 0em;
    }
    .masthead .logo.item img {
      margin-right: 1em;
    }
    .masthead .ui.menu .ui.button {
      margin-left: 0.5em;
    }
    .masthead h1.ui.header {
      margin-top: 3em;
      margin-bottom: 0em;
      font-size: 4em;
      font-weight: normal;
    }
    .masthead h2 {
      font-size: 1.7em;
      font-weight: normal;
    }

    .ui.vertical.stripe {
      padding: 8em 0em;
    }
    .ui.vertical.stripe h3 {
      font-size: 2em;
    }
    .ui.vertical.stripe .button + h3,
    .ui.vertical.stripe p + h3 {
      margin-top: 3em;
    }
    .ui.vertical.stripe .floated.image {
      clear: both;
    }
    .ui.vertical.stripe p {
      font-size: 1.33em;
    }
    .ui.vertical.stripe .horizontal.divider {
      margin: 3em 0em;
    }

    .quote.stripe.segment {
      padding: 0em;
    }
    .quote.stripe.segment .grid .column {
      padding-top: 5em;
      padding-bottom: 5em;
    }

    .footer.segment {
      padding: 5em 0em;
    }

    .secondary.pointing.menu .toc.item {
      display: none;
    }

    @media only screen and (max-width: 700px) {
      .ui.fixed.menu {
        display: none !important;
      }
      .secondary.pointing.menu .item,
      .secondary.pointing.menu .menu {
        display: none;
      }
      .secondary.pointing.menu .toc.item {
        display: block;
      }
      .masthead.segment {
        min-height: 350px;
      }
      .masthead h1.ui.header {
        font-size: 2em;
        margin-top: 1.5em;
      }
      .masthead h2 {
        margin-top: 0.5em;
        font-size: 1.5em;
      }
    }
  </style>
  <style type="text/css">

    .search-form {
      position: relative;
      top: 50%;
      left: 50%;
      width: 100%;
      height: 60px;
      border-radius: 3px;
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
      -webkit-transform: translate(-50%, -50%);
      transform: translate(-50%, -50%);
      background: #fff;
      -webkit-transition: all 0.3s ease;
      transition: all 0.3s ease;
    }

    .search-form.focus {
      box-shadow: 0 3px 4px rgba(0, 0, 0, 0.15);
    }

    .search-input {
      position: absolute;
      top: 10px;
      left: 38px;
      font-size: 14px;
      background: none;
      color: #5a6674;
      width: 195px;
      height: 20px;
      border: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      outline: none;
    }

    .search-input::-webkit-search-cancel-button {
      -webkit-appearance: none;
      appearance: none;
    }

    .search-button {
      position: absolute;
      top: 22px;
      left: 12px;
      height: 20px;
      width: 20px;
      padding: 0;
      margin: 0;
      border: none;
      background: none;
      outline: none !important;
      cursor: pointer;
    }

    .search-button svg {
      width: 20px;
      height: 20px;
      fill: #5a6674;
    }

    .search-option {
      position: absolute;
      text-align: right;
      top: 20px;
      right: 15px;
    }

    .search-option div {
      position: relative;
      display: inline-block;
      margin: 0 1px;
      cursor: pointer;
    }

    .search-option div input {
      position: absolute;
      top: 0;
      left: 0;
      opacity: 0.01;
      cursor: pointer;
    }

    .search-option div span {
      position: absolute;
      display: block;
      text-align: center;
      left: 50%;
      -webkit-transform: translateX(-50%);
      transform: translateX(-50%);
      opacity: 0;
      background: #929AA3;
      color: #fff;
      font-size: 9px;
      letter-spacing: 1px;
      line-height: 1;
      text-transform: uppercase;
      padding: 4px 7px;
      border-radius: 12px;
      top: -18px;
      -webkit-transition: all .2s ease-in-out;
      transition: all .2s ease-in-out;
    }

    .search-option div span::after {
      content: '';
      position: absolute;
      bottom: -3px;
      left: 50%;
      -webkit-transform: translateX(-50%);
      transform: translateX(-50%);
      border-top: 4px solid #929AA3;
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      -webkit-transition: all .2s ease-in-out;
      transition: all .2s ease-in-out;
    }

    .search-option div:hover span {
      opacity: 1;
      top: -21px;
    }

    .search-option div label {
      display: block;
      cursor: pointer;
    }

    .search-option div svg {
      height: 20px;
      width: 20px;
      fill: #5a6674;
      opacity: 0.6;
      -webkit-transition: all .2s ease-in-out;
      transition: all .2s ease-in-out;
      pointer-events: none;
    }

    .search-option div:hover svg {
      opacity: 1;
    }

    .search-option div input:checked + label svg {
      fill: #e24040;
      opacity: .9;
    }

    .search-option div input:checked + label span {
      background: #e24040;
    }

    .search-option div input:checked + label span::after {
      border-top-color: #e24040;
    }

    .posts{
        height: 10em;
        background: white;
        border-radius: 3px;
        margin-bottom: 30px;
        -webkit-box-shadow: 1px 2px 3px #d6d4d4;
        box-shadow: 1px 2px 3px #d6d4d4;
        border: 1px solid #d6d4d4;
    }
    
    .posts img{
        float: right;
        height: 100%;
        border-radius: 0px 3px 3px 0px;
        -webkit-clip-path: polygon(44% 0, 100% 0%, 100% 100%, 0% 100%);
        clip-path: polygon(20% 0, 100% 0%, 100% 100%, 0% 100%);
    }

    .posts-des{
        position: relative;
        left: 3%;
        padding: 20px;
        float: left;
    }

    .posts-des h2{
        color: #7b7b7b;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 15em;
    }

    .posts-des p{
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 23em;
    }

    .big-preface{
        font-weight:100;
        transform: skew(-10deg);
        display: block;
        position: relative;
        left: 25%;
    }

    @media only screen and (max-width: 760px) {
        .posts img{
            display: none;
        }

        .posts-des h2 {
            width: 13em;
        }

        .posts-des p{
            width: 17em;
        }

        .big-preface{
            left: 10%;
            width: 80%;
        }

    }
  </style>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="/components/visibility.js"></script>
  <script src="/components/sidebar.js"></script>
  <script src="/components/transition.js"></script>
  <script>
  $(document)
    .ready(function() {

      // fix menu when passed
      $('.masthead')
        .visibility({
          once: false,
          onBottomPassed: function() {
            $('.fixed.menu').transition('fade in');
          },
          onBottomPassedReverse: function() {
            $('.fixed.menu').transition('fade out');
          }
        })
      ;

      // create sidebar and attach to menu open
      $('.ui.sidebar')
        .sidebar('attach events', '.toc.item')
      ;

      //-----
		/*$('.ui.search').search({
		    apiSettings: {
		      url: '/api/search?q={query}'
		    },
		    fields: {
		      results : 'results',
		      title   : 'title',
		      description : 'preface',
		      url     : '_id'
		    },
		    minCharacters : 3
		  })
		;*/


      //--

    })
  ;
  </script>
</head>
<body>

<!-- Sidebar Menu -->
<div class="ui vertical inverted sidebar menu">
  <a class="active item">Home</a>
  <a class="item">Work</a>
  <a class="item">Company</a>
  <a class="item">Careers</a>
  <a class="item">Login</a>
  <a class="item">Signup</a>
</div>

<%
    try{

      data[0];

      if(data[0] == null) throw new Error();

    }catch(e){

      var data = [];
      data[0] = {
        title: "沒有找到任何文章",
        preface: "Not found any article about that.",
        feature_picture : "https://unsplash.it/1920/1080?random",
        liked : 0,
        view: 0,
        author: "system",
        hash_tag:["system"],
        date : new Date(),
        isNull : true
      }

    }
%>

<!-- Page Contents -->
<div class="pusher">
  <div class="ui inverted vertical masthead center aligned segment" style="
  background: linear-gradient(      rgba(0,0,0,0.6),       rgba(0,0,0,0.6)),url(<%= data[0].feature_picture %>) no-repeat center center fixed;
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover;
">

    <div class="ui container">
      <div class="ui large secondary inverted pointing menu" style="
    border-color: rgba(0,0,0,0) !important;
">
        <a class="toc item">
          <i class="fa fa-bars" aria-hidden="true"></i>
        </a>
        <a class="item" href="/">Home</a>
        <a class="active item" href="/explore">瀏覽</a>
        <a class="item" href="/hashtag">HashTag</a>
      </div>
    </div>

    <% var colors = ["#e55643","#2b9f5e","#f1c83c"]; 
       var color = colors[Math.floor(Math.random()*colors.length)];
    %>

    <div class="ui text container" style=" margin-bottom: 30px; ">
      <h1 class="ui inverted header">
        <div style="transform: translateX(-50%) rotate(-10deg); display: block; text-shadow: #533d4a 1px 1px, #533d4a 2px 2px, #533d4a 3px 3px, #533d4a 4px 4px, #533d4a 5px 5px, #533d4a 6px 6px; position: relative; left: 50%; bottom: 50px;">
          <span style="font-size: 0.35em;position: relative;left: -37%;transform: skew(-10deg);display: block; color:#FFEA00;">最新文章:</span>
          <a href="/article?id=<%= data[0]._id %>" style="color:<%= color %>; border-bottom: 1px solid currentColor; text-decoration: none; font-weight:900; transform: skew(-10deg); display: block;"><%= data[0].title %></a>
          <h3 class="big-preface"><%= data[0].preface %></h3>
        </div>
      </h1>
      <h4>@<%= data[0].author %></h4>
      <h4><i class="fa fa-calendar" style="color: #00c0ff;" aria-hidden="true"></i> <%= data[0].date.toLocaleString() %> &nbsp;&nbsp;&nbsp; <i class="fa fa-fire" aria-hidden="true" style="color: #ff4b00;"></i> <%= data[0].view %> &nbsp;&nbsp;&nbsp; <i class="fa fa-heart" aria-hidden="true" style="color:red"></i> <%= data[0].liked %></h4>
      <h5><i class="fa fa-tags" aria-hidden="true"></i> <%= data[0].hash_tag %></h5>
    </div>
  </div>

  <div class="ui text container" style="
    padding-bottom: 50px;
    padding-top: 50px;
    word-break: break-all;">
    <!-- search by https://codepen.io/supah/pen/XdKMJK-->
    <form class="search-form">
      <input type="search" name="q" value="" placeholder="搜尋文章..." class="search-input" style="height:40px;font-size:18px;width: 80%;">
      <button type="submit" class="search-button">
        <svg class="submit-button">
          <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#search"></use>
        </svg>
      </button>
      <div class="search-option">   
        <div>
          <input name="type" type="radio" value="type-users" id="type-users">
          <label for="type-users">
            <svg class="edit-pen-title">
              <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#user"></use>
            </svg>
            <span style=" width: 60px; ">搜尋作者</span>
          </label>
        </div>     
        <div>
          <input name="type" type="radio" value="type-posts" id="type-posts">
          <label for="type-posts">
            <svg class="edit-pen-title">
              <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#post"></use>
            </svg>
            <span style=" width: 60px; ">尋找文章</span>
          </label>
        </div>
      </div>
    </form>
    <svg xmlns="http://www.w3.org/2000/svg" width="0" height="0" display="none">
  <symbol id="search" viewBox="0 0 32 32">
    <path d="M 19.5 3 C 14.26514 3 10 7.2651394 10 12.5 C 10 14.749977 10.810825 16.807458 12.125 18.4375 L 3.28125 27.28125 L 4.71875 28.71875 L 13.5625 19.875 C 15.192542 21.189175 17.250023 22 19.5 22 C 24.73486 22 29 17.73486 29 12.5 C 29 7.2651394 24.73486 3 19.5 3 z M 19.5 5 C 23.65398 5 27 8.3460198 27 12.5 C 27 16.65398 23.65398 20 19.5 20 C 15.34602 20 12 16.65398 12 12.5 C 12 8.3460198 15.34602 5 19.5 5 z" />
  </symbol>
  <symbol id="user" viewBox="0 0 32 32">
    <path d="M 16 4 C 12.145852 4 9 7.1458513 9 11 C 9 13.393064 10.220383 15.517805 12.0625 16.78125 C 8.485554 18.302923 6 21.859881 6 26 L 8 26 C 8 21.533333 11.533333 18 16 18 C 20.466667 18 24 21.533333 24 26 L 26 26 C 26 21.859881 23.514446 18.302923 19.9375 16.78125 C 21.779617 15.517805 23 13.393064 23 11 C 23 7.1458513 19.854148 4 16 4 z M 16 6 C 18.773268 6 21 8.2267317 21 11 C 21 13.773268 18.773268 16 16 16 C 13.226732 16 11 13.773268 11 11 C 11 8.2267317 13.226732 6 16 6 z" /></symbol>
  <symbol id="images" viewbox="0 0 32 32">
    <path d="M 2 5 L 2 6 L 2 26 L 2 27 L 3 27 L 29 27 L 30 27 L 30 26 L 30 6 L 30 5 L 29 5 L 3 5 L 2 5 z M 4 7 L 28 7 L 28 20.90625 L 22.71875 15.59375 L 22 14.875 L 21.28125 15.59375 L 17.46875 19.40625 L 11.71875 13.59375 L 11 12.875 L 10.28125 13.59375 L 4 19.875 L 4 7 z M 24 9 C 22.895431 9 22 9.8954305 22 11 C 22 12.104569 22.895431 13 24 13 C 25.104569 13 26 12.104569 26 11 C 26 9.8954305 25.104569 9 24 9 z M 11 15.71875 L 20.1875 25 L 4 25 L 4 22.71875 L 11 15.71875 z M 22 17.71875 L 28 23.71875 L 28 25 L 23.03125 25 L 18.875 20.8125 L 22 17.71875 z" />
  </symbol>
  <symbol id="post" viewbox="0 0 32 32">
    <path d="M 3 5 L 3 6 L 3 23 C 3 25.209804 4.7901961 27 7 27 L 25 27 C 27.209804 27 29 25.209804 29 23 L 29 13 L 29 12 L 28 12 L 23 12 L 23 6 L 23 5 L 22 5 L 4 5 L 3 5 z M 5 7 L 21 7 L 21 12 L 21 13 L 21 23 C 21 23.73015 21.221057 24.41091 21.5625 25 L 7 25 C 5.8098039 25 5 24.190196 5 23 L 5 7 z M 7 9 L 7 10 L 7 13 L 7 14 L 8 14 L 18 14 L 19 14 L 19 13 L 19 10 L 19 9 L 18 9 L 8 9 L 7 9 z M 9 11 L 17 11 L 17 12 L 9 12 L 9 11 z M 23 14 L 27 14 L 27 23 C 27 24.190196 26.190196 25 25 25 C 23.809804 25 23 24.190196 23 23 L 23 14 z M 7 15 L 7 17 L 12 17 L 12 15 L 7 15 z M 14 15 L 14 17 L 19 17 L 19 15 L 14 15 z M 7 18 L 7 20 L 12 20 L 12 18 L 7 18 z M 14 18 L 14 20 L 19 20 L 19 18 L 14 18 z M 7 21 L 7 23 L 12 23 L 12 21 L 7 21 z M 14 21 L 14 23 L 19 23 L 19 21 L 14 21 z" />
  </symbol>
  <symbol id="special" viewbox="0 0 32 32">
    <path d="M 4 4 L 4 5 L 4 27 L 4 28 L 5 28 L 27 28 L 28 28 L 28 27 L 28 5 L 28 4 L 27 4 L 5 4 L 4 4 z M 6 6 L 26 6 L 26 26 L 6 26 L 6 6 z M 16 8.40625 L 13.6875 13.59375 L 8 14.1875 L 12.3125 18 L 11.09375 23.59375 L 16 20.6875 L 20.90625 23.59375 L 19.6875 18 L 24 14.1875 L 18.3125 13.59375 L 16 8.40625 z M 16 13.3125 L 16.5 14.40625 L 17 15.5 L 18.1875 15.59375 L 19.40625 15.6875 L 18.5 16.5 L 17.59375 17.3125 L 17.8125 18.40625 L 18.09375 19.59375 L 17 19 L 16 18.40625 L 15 19 L 14 19.59375 L 14.3125 18.40625 L 14.5 17.3125 L 13.59375 16.5 L 12.6875 15.6875 L 13.90625 15.59375 L 15.09375 15.5 L 15.59375 14.40625 L 16 13.3125 z" />
  </symbol>
</svg>

  <p>總共搜尋 <%= max_length %> 筆資料，一共 <%= Math.ceil(max_length / per_length) %> 頁 (目前第 <%= Math.ceil(now_end_length / per_length) %> 頁)。</p>

	<% 
    if(!data[0].isNull)
    for(var i = 0; i<data.length; i++){ 
    var art = data[i];
  %>
  <div class="posts">
      <div class="posts-des">
          <h2><%= art.title %></h2>
          <p><%= art.preface %></p>
          <button class="compact ui button" onclick="location.href = '/article?id=<%= art._id %>';">繼續閱讀 >></button>
      </div>
      <img src="<%= art.feature_picture %>" alt="" onerror="this.src='https://unsplash.it/860/640?random'" style=" width: 15em; /* 避免圖片溢位*/">
  </div>
	
  <% } %>



    
    <div class="ui pagination menu">
      <% 
          var max_page = Math.ceil(max_length / per_length);
          var now_page = Math.ceil(now_end_length / per_length);
          var query_page_count = 1;

          if(now_page < 4) { 
              query_page_count = 3;
          }else{
            query_page_count = now_page;
          }

          if(max_page > 5 && (max_page - now_page) < 2){
              query_page_count = max_page - 2;
          }
      %>

      <!-- 1 .. -->
      <% if(now_page > 3 && max_page > 5 && max_page != 4){ %>
          <a class="item <%= activeClass %> page-number">
            1
          </a>
      <% } %>
      <% if(now_page > 4 && max_page > 5){ %>
          <div class="disabled item">
            ...
          </div>
      <% } %>


      <!-- 345 -->
      <% 
          var start_from = query_page_count-2;
          var end_to = query_page_count+2;
        
          if((max_page - now_page) < 2){
              start_from = max_page - 4;
              end_to = max_page;
          }

          if(max_page < 5){
              start_from = 1;
              end_to = max_page;
          }


          for(var k = start_from;k<=end_to;k++){ 
              var activeClass = "";
              if(now_page == k){
                  activeClass = "active";
              }
        %>
          <a class="item <%= activeClass %> page-number">
            <%= k %>
          </a>
      <% } %>




      <!-- ..last -->
      <% if((max_page - now_page) > 3 && max_page > 5){ %>
          <div class="disabled item">
            ...
          </div>
      <% } %>
      <% if((max_page - now_page) > 2 && max_page > 5 && max_page != 4){ %>
          <a class="item <%= activeClass %> page-number">
            <%= max_page %>
          </a>
      <% } %>


      <!--if no any thing-->
      <% if (max_page == 0){ %><div class="active item">1</div> <% } %>

    </div>





  </div>


  <div class="ui black inverted vertical footer segment">
  	<div class="ui center aligned container">
    	<div class="ui horizontal inverted small divided link list">
    		<h6>system open source - License MIT.</h6>
      		<h5>2016 創立於和春科技大學資訊工程系 J605B 人機互動實驗室</h5>
      		<h5>WebDesign By MacTaylor, this project from J605b soft-lab, system open source - License MIT. All Authors are certified by our school!</h5>
    	</div>
  	</div>
  </div>

</div>
</div>
<script type="text/javascript">
  $('.search-input').focus(function(){
    $(this).parent().addClass('focus');
  }).blur(function(){
    $(this).parent().removeClass('focus');
  });

  var parseQueryString = function() {
      var str = window.location.search;
      var objURL = {};
      str.replace(
          new RegExp( "([^?=&]+)(=([^&]*))?", "g" ),
          function( $0, $1, $2, $3 ){
              objURL[ $1 ] = $3;
          }
      );
      return objURL;
  };

  //Example how to use it: 
  var params = parseQueryString();
  var qstr = "";
  if(!!params["q"]){
      qstr = "&q=" + params["q"];
  }

  $(".page-number").click(function(){
      var page = parseInt($(this).html());
      var start = 0;

      if(page > 1){
          start = (page * 10) - 10 - 1;
      }

      location.href = "/explore?s=" + start + qstr;
  });
</script>
<script src="/javascripts/semantic.min.js"></script>
</body>
</html>